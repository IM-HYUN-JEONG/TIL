## 1. Transactions and UTXOs

➡️ 트랜잭션과 미사용 트랜잭션 출력값인 UTXO / 은행 시스템과 어떻게 다른지 / 트랜잭션의 핵심원리 /

- UTXO : 미사용 트랜잭션 출력값 (트랜잭션에 사용되면 기록에서 사라짐)
- 은행시스템은 한번 트랜잭션을 보내면 끝이지만(=트래잭션이 완료되면 어딘가에 기록하는 식)
- 같은사람이 다른값의 트랜잭션을 보냈을경우, 하나의 UTXO로 집계되지않음 (개별TX로 유지)
- 비트코인에서는 트랜잭션이 실행된 후에도 해당 트랜잭션의 UTXO가 다른 트랜잭션을 만들 때까지 지속됨
- A물건(0.3BTC)을 사려면 그 입력값에 연결할 0.3BTC이상이 있는 트랜잭션을 선택
- 규칙 : 미사용 출력값이 없어야 함
- 만약 0.3짜리 물건을 사는데 0.5가 있는 트랜잭션을 골랐을 경우, 0.3은 가게주인으로 0.2는 내 지값으로 보내느 output을 짜야한다.(=input에 들어간 모든것은 미사용되면 안됨 / input에 들어간 모든 것은 전체금액으로 output되어야한다.)
- input에서 돈을 얻고, 지갑으로 갈 수는 없음 <br />
  (\*모든 암호화폐에는 지갑(계좌)에 돈이 없고 계좌도 없음) <br />
  (=가진것은 블록체인과 모든 트랜잭션 뿐 <br />
  (=모든 돈의 이동은 블록체인에서의 트랜잭션이다) <br />
- 잔고라는 것은 없지만 UTXO(미사용TX)=잔고와 같은 개념
-

## 2. Where do transaction fees come from?

➡️ 거래수수료의 출처

- 채굴자들이 블록을 추가 -> 멤풀에는 많은 트랜잭션이 대기중 -> 트랜잭션이 수용되게 하려면 수수료를 내야함(=자진해서 수수료를 내거나 입찰을 함) -> 수수료가 높을수록 트랜잭션이 수용될 가능성 큼
- 수수료를 지정하는 방식 : 수수료를 지정하는 필드가 없고 자동으로 계산됨(총 입력값-총 출력값)
- 예시, 가방(0.8BTC), 핸드폰(0.15BTC)를 구매할건데 input은 1BTC이면 output에 0.8BTC for Bag, 0.15BTC for iPhone, 0.05BTC for miner(수수료) 이렇게 자동으로 수수료가 계산되어진다.

## 3. How wallets work

➡️ 암호화폐지갑을 설정했을 때의 지갑 원리

- 지갑은 사용가능한 총 UTXO를 계산하고 그것을 잔고라고 부름 (=UTXO의 조합으로 존재)
- 지갑은 전체 트랜잭션(=블록체인)을 거쳐서 남은 UTXO를 얻어야 한다
- 지갑은 연결방식을 볼 수 있기 때문에 분석을 함 -> 블록체인을 통과함 -> 출력값이 도출되는 모든 트랜잭션을 확인 -> 미사용 트랜잭션 출력값인 UTXO가 있는지 확인 -> 있다면 그 값들을 더함 -> 총합을 잔고로 보여줌
- But실제로는 돈을 저장할 곳이 없음 ~> 암호화폐에는 코인이 존재하지않기 떄문

## 4. Signatures : Private & Public Keys

➡️ 서명, 개인키, 공개키 / 블록체인의 트랜잭션 측면에서 프라이버시 작동원리

- 블록체인을 시작하면 Private Keys(개인키)가 할당됨
- Private Keys(개인키) : 고유식별자왁 같은것으로 나의 암호화폐라는 것을 누구에게도 알리지 않는 것 <br />
  (=은행계좌의 비밀번호같은 존재)
- Private Keys(개인키)로 Public Keys(공개키)를 생성할 수 있음
- Public Keys(공개키) : 다른사람과 공유할 수 있음, 공개키를 통해 서로 돈을 주고받을 수 있는 것, 돈을 보낼 때 다른사람과 공유할 수 있음 <br />
  (=은행계좌같은 존재)
- 돈을 보내기 위해서는 개인키가 필요함
- 메세지(트랜잭션)을 보낼 때
- 개인키와 트랜잭션이 결합하여 Signature(서명)을 만들어냄 / 개인키는 트랜잭션 서명에 사용되고 자신만이 고유의 개인키를 알고있는 것 / 트랜잭션은 늘 이 서명과 같이 있음 ~> 누구라도 이 트랜잭션을 접하면 이 서명도 접하게 되는 것
- 그러면 누가만든 서명인지 확인할까?
- 이때, 공개키가 필요함
- 블록체인 알고리즘에는 Verification Function(검증함수)가 있는데 트랜잭션과 서명, 공개키만 있으면 불리언값으로 분할할 수 있다
- 결국 공개키를 사용해서 서명과 메세지의 결합을 평가해 개인키로 이 메세지에 서명했는지 여부를 확인하거나 거부함
- 타원함수를 사용하기 떄문에 공개키를 사용한다고 해도 개인키를 역설계할 수 없음 / 개인키를 통해서 공개키를 생성할 수 있지만 개인키를 역설계할 수 없다
- Verification Function(검증함수)는 공개키를 사용하고 이 함수는 공개 키를 통해서 검증을 수행하도록 설계됨 / 트랜잭션의 서명이 공개키를 생성한 개인키에서 온 것인지 확인할 수 있음 / 돈을 보내려고 한다는 것을 출분한 검증을 해줌
- 블록체인에 트랜잭션을 보낼 떄, 트랜잭션을 블록체인에 넣거나 멤풀에 넣을 수도 있음. 하지만 항상 첨부되는 트랜잭션은 서명과 공개키임
- 결국 모든 컴포넌트(트랜잭션,서명,공개키)가 블록체인 안에 있게 된다.
- 노드와 모든 채굴자가 실제로 이 트랜잭션이 개인키를 가진 사람에 의해 만들어졌음을 확인할 수 있다.
- 예) A가 B에게 1BTC를 보내려고 함 -> 가지고 있는 서명으로 트랜잭션에 서명을 하고 공개키도 가지고 있음 -> 네트워크의 모든 노드는 검증함수를 서명,개인키,공개키라는 컴포넌트에 적용하면 서명이 공개키를 발급한 것과 동일한 개인키로 생성되었음을 알 수 있다. -> 즉 A가 이 트랜잭션을 생성했다는 의미

- 정리 : 개인키는 공개X, 공개키는 공개O / 메세지나 트랜잭션 생성시 개인키로 서명을 함 / 공개키 사용이 가능하여 트랜잭션을 검증해야 함 / 메세지나 트랜잭션이 어디로 이동하던지 항상 공개키가 첨부됨 /
  네트워크상의 모든노드는 메세지 또는 트랜잭션과 공개키, 서명을 얻게 됨 / 그 3가지로 검증함수에 사용하여 개인키 소유자의 것인지 검증을 함 /
- 개인키 접근권한이 없는데 가짜서명으로 위조하려고 한다면 검증이 안됨

## 5. What is Segregated Witness? (SegWit)

➡️ 세그윗 : 분리된 증인 = 블록을 분리한다 / 세그윗의 정의, 왜 중요한지 / 비트코인이나 다른 네트워크에 필요한 이유

- (복습) 블록구성 : 블록번호, 타임스탬프, 논스, 트랜잭션, 이전해시, 현재해시 ~> 이 모든것을 합쳐서 블록헤더라고 함

- 비트코인에는 블록이 1MB의 사이즈 제한이 있음 -> But 트랜잭션 백로그가 발생 -> 하드포크와 소프트포크의 접근방법이 있음 <br />
  1️⃣ 하드포크 : 블록크기를 증가시킴 (비트코인 캐시) <br />
  2️⃣ 소프트포크 : 블록체인 작동방식을 업그레이드 하는것과 같음, 모든사람이 반드시 고려해야할것은 아님(세그윗) <br />
- 세그윗 : 개별트랜잭션의 콘텐츠를 확인하는 것 / 네트워크 처리량과 속도를 늘려줌 / scripySig(Signature, Public Key)를 자체메시징체널로 분리하는 것
- 블록안에 있는 트랜잭션에 From,To,Amount, Signature, Public Key가 있는데 Signature, Public Key는 큰데이터를 차지함(전체 트랜잭션 사이즈의 60%) -> 그래서 자체메시징서비스와 네트워크를 통해 메세지에서 scripySig라고 불리는 큰 부분을 제거하고 보내도록 계획됨 -> 그래서 각 블록과 트랜잭션에 여전히 연결되어 있지만 네트워크를 개별적으로 통과하는 것 -> 이렇게 하면 공간을 절약하고 각 트랜잭션의 크기를 줄여 더 많은 트랜잭션을 수용할 수 있게 됨
- 세그윗이 블록크기를 늘렸다(X) -> 블록크기는 여전히 1MB(사이즈를 변경하려면 하드포크가 필요), 이전에는 1MB의 데이터만 포함할 수 있었다면 지금은 2MB같은 많은 데이터를 포함할 수 있다는 것

## 6. Public Keys vs Bitcoin Address

➡️ 공개키와 비트코인 주소의 차이점

- (복습) 공개키를 처리하는 개인키, 개인키를 사용해 메세지 혹은 트랜잭션을 생성하고 서명 생성메세지를 보내면 공개키, 메세지(트랜잭션),서명을 검증함수에 넣어서 불리언값을 얻음

- 비트코인 주소 : 공개키에서 얻을 수 있고 (SHA256해시함수를 적용해 얻을 수 있다)(해시함수는 결정성을 가짐 ~> 충돌이 발생할 가능성이 낮음, 동일한 공개키에서는 동일한 주소를 얻게 됨)
- 주소 : 돈을 보내달라고 요청할 수 있는 곳(공개O)
- 비트코인을 공개키로도 보낼 수 있다 ~> 공개키나 주소를 알려주면 돈이 전송됨
- 주소는 왜 필요? = 개인키와는 다른 방법으로 공개키를 안전하게 지키기 위해서(자주 노출되지 않도록) <br />
  누군가에게 돈이나 비트코인을 보낼때는 검증함수를 실행시켜야하기에 반드시 공개키를 노출해야 하는데 돈을 받을때는 노출을 방지해야 함! 이때 주소를 씀
- 그러면 공개키 노출을 방지해야하는 이유? = 개인키를 확인,생성하는 방법은 없다, 개인키에서 타원함수를 통해 공개키가 생성됨, 만약 타원함수의 결함이 밝혀지거나하면 공개키를 통해 개인키로 이동하는 방법을 찾을 수 있게됨
- 그래서 모든 트랜잭션에서 모두에게 공개키를 제공하면 누군가는 곧 개인키를 얻게 됨
- 해싱알고리즘의 SHA256으로 추가 보안층을 생성하면 누군가 그 타원함수 연결을 역설계하더라도 공개키와 주소간의 추가보안층이 있기때문에 주소만 얻게 됨

## 7. Hierarchically Deterministic (HD) Wallet

➡️ 계층결정 지갑 : HD지갑

- 개인키가 누구의 소유인지 모르는 한 정체를 아는사람도 없음 / 트랜잭션을 기반으로 정체를 알수없는것이 기본설정
- 누군가에게 송금을 할때면 항상 주소를 보내야함 -> 송금을 할 때마다 매번 공개키가 해당 트랜잭션에 포함됨 -> 따라서 송금을 받는 사람은 전체 블록체인네트워크를 살펴볼 수 있고, 거래양상을 관찰 할 수 있음
- (해결1) 프라이버시를 위해 여러 개인키를 만들어 키마다 공개키와 주소를 따로생성하여 특정항목별로 사용 But 개인키의 보안을 유지하는 작업이 귀찮음

<img width="600" alt="스크린샷 2022-04-04 오후 6 25 19" src="https://user-images.githubusercontent.com/95120267/161517763-cd7b2dcf-13c7-4442-87c3-98bb1868fd31.png">


- (해결2) Bip32기술
- HD지갑을 통해 마스터개인키를 가질 수 있음, 오직 마스터개인키를 통해서만 개인키를 생성할 수 있다. 그리고 해당 개인키를 통해서 공개키를 생성하고 이를 통해 주소를 생성함 (\*마스터개인키나 개인키 정보는 공개되어서는 안됨)
  - 공개키와 주소를 더 생성할 수 있는데, 마스터개인키는 해시함수를 사용하여 개인키를 생성함
  - 마스터개인키에 대한 접근권한만 있으면 원하는만큼 개인키와 공개키를 만들 수 있고 언제든지 재생성할 수 있다
  - 마스터개인키의 장점은 언제든지 블록체인에 가서 해당키의 지출내역을 낱낱이 확인할 수 있음(=개인키에서 발생한 모든 트랜잭션을 볼 수 있음)
  - 니모닉암호를 통해 마스터개인키를 복구하고 통제할 수 있음
- 마스터공용키를 통해서는 개인키를 생성할수없다 / 마스터공용키는 공개키를 다시만들 수 있음
- 타인에게 자금을 보내려면 개인키가 필요/ 감사인은 공개키에 대한 접근권한을 필요로함(자금을 어디서받았는지를 확인해야해서)
- HD지갑이 모든트랜잭션에 대해 다른주소와 해당주소에 대한 다른 공개키를 사용하도록 지원함

## 정리

1. UTXO = Unspent Transaction Output (미사용 트랜잭션 출력값)

2. 은행과 블록체인의 차이

- 은행
  - 잔고라는 개념이 있다, 트랜잭션은 그 잔고에 더하거나 뺨
- 블록체인
  - 잔고라는 개념이 없다
  - 각 트랜잭션은 각자의 수명이 있고, 다른 트랜잭션들에서 시작하고 다른트랜잭션들로 끝나야 함
  - 암호화폐 지갑이 보여주는 것은 블록체인에 있는 내가 발신자 또는 수신자로 하는 모든 트랜잭션의 모음

3. 트랜잭션 수수료

- 수수료 : 트랜잭션의 입력값과 출력값의 차이
- 채굴자는 미사용된 것을 모두 받고, 설정가능함

4. 개인키는 검증함수로 메세지 혹은 트랜잭션의 유효성을 검증하는데 필요없다.

5. 주소와 공개키는 매우 유사하고, 주소는 공개키의 SHA256암호화된 버전이더. 타원곡선이 해킹된 경우 추가적인 보안을 위해 수행됨

## [출처](https://www.udemy.com/course/best-blockchain-az/)
