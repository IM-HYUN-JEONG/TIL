블록생성 사이클
블록생성주기 = 라운드
블록생성간격 = 약 1초

## 제안자와 위원회 선택 (Proposer and Committee Selection)

제안자를 무작위&결정적으로 Governance Council(합의노드들) 노들 중 뽑음
각각의 합의노드가 가장 최근의 블록헤더에서 파생 된 난수 사용하여 자기가 라운드에 선택됐는지 증명하는 암호화 작업을 한다

## 블록 제안과 검증(Block Proposal and Validation)

하나의 노드가 제안자로 선택이되면 그 라운드에서 제안자로 뽑힌 증거를 다른 합의노드들에게 알리게 됨
어떤 증거냐면 제안자의 공개키 통해 입증가능한 암호증명을 쓴다.
그리고 해당라운드의 위원회로 뽑힌 노드그룹은 제안자에게 자기가 왜 위원회노드로 뽑히게 되었는지 증거와 함께 알려줌
이제 누가 제안자고 위원회인지 파악이되면, 제안자가 트랜잭션 풀에서 트랜잭션을 선택하고 정렬해서 블록을만들고 합의를한다

## 블록전파(Block Propagtion)

제안된 블록은 성공적으로 완료되기위해 위원회멤버들의 2/3이상의 서명을 받아야함
위원회가 합의에 이루게되면 새로운 블록이 모든 합의노드들에게 전달되고 합의라운드는 끝이남
프록시 노드를 통해 엔드포인트 노드들에게 전달이 된다.

<hr />

## <클레이튼 네트워크 구조>

네트워크는 크게 1)Core Cell Network와 2)Endpoint Node Network로 구성되어있다.
하나의 코어셀은 하나의 참여자가 운영 하나의 CNN과 여러개의 PNN으로 운영이됨

1. Core Cell Network는 (1)CNN(Consensus Node Network)와 (2)PNN(Proxy Node Network)로 이루어져있다
   (1)CNN(Consensus Node Network)=합의노드네트워크

- 합의를 담당하는 노드들
- CN으로 참여하려면 까다로운 조건을 갖춰야하고 자기들끼리 소통할수있도록 연결되어있는 구조 (최대한 빨리 커뮤니케이션을 해야하기에)
- 외부와 직접적으로 접촉할수없고 방해가 없는 프라이빗하기에 빨리 결정을 만들어내는 장점
- PN을 통하여 소통을 한다.
- CN부트노드(비공개) = 새로들어온 노드가 네트워크에 등록하고 다른노드에 연결할 수있도록 도움을 주는 특수 노드

(2)PNN(Proxy Node Network)=프록시노드네트워크

- EN과 연결이되어 정보를 주고받음
- PN부트노드(공개) = 허용된 프록시노드만 등록할수있게하고 EN과 연결할 수 있게 도와줌

2. Endpoint Node Network는 ENN(Endpoint Node Network)들로 이루어져있다.

<hr />

## <코어 셀> = 합의를 담당함

- 사용자가 많아져서 확장이 필요할 때, 일반적이면 서버를 늘리고 Request를 분할하여 처리한다
- 블록체인의경우, 노드들을 늘려봤자 늘린만큼 정보를 각 노드들에게 더 전달을해야해서 처리속도가 느려질수있음 = 노드를 늘려봤자 성능과 비례하지 않음.
- 그래서 클레이튼 = 노드 자체의 성능을 늘린다

### -> CN(합의노드) 참여조건

- Physical core가 40개 이상
- 256GB RAM
- 1년치의 데이터 약 14TB저장
- 10G 네트워크

<hr />

## <서비스체인>

= 메인넷과 연결된 독립적으로 운영되는 블록체인

- 언제쓰이나? -> 비앱이 특별한 노드환경에서 설정하거나 보안수준의 맞춤형으로 설정하거나 많은 처리량요구하거나 메인넷으로 배포할 경우 경제성이 낮을경우 사용한다
- 즉 독립된 서비스공간을 구축해서 필요할 때 메인넷에 신뢰를 고정시키는 것
- 클레이튼의 서비스체인안에서는 트랜잭션에 소요되는 가스비용을 안받게 설정 가능하다!!!
  = 즉, BAPP서비스 제공자가 서비스체인안에서 자기가 원하는 환경을 구축하고 서비스를 유저들에게 제공할 수있다는 뜻

<hr />

## <이더리움과 클레이튼의 차이>

### 1. 이더리움

- 단일 네트워크(네트워크 구성원간의 구분이 없음=누구나 블록을 만들 수 있음)
- 단, 블록을 만들었을 때 가장 먼저 블록을 만들고 많이 전파해야 함
- Proof-of-Work(작업증명)
- 마이닝노드(블록을 채굴할 노드)가 누가될지 모르기때문에, 최대한 많은 노드들에게 붙어야 한다.
- 쉽게말해 블록을 쓰는 노드는 최신정보를 가지고있음. 내가 이 정보를 빨리 받아야하는데 이 노드가 어디있는지모름. 만약 A노드가 블록 Write를 담당하면, B노드는 A노드 옆에 달라붙어있어야 좋음. 정보를 빨리 받아볼수있으니까
- 하지만 이더리움은 그 역할을 담당하는 노드가 항상 바뀌기때문에, 어떻게든 많은 노드들에게 붙어서 전파(가식)을 받아야함. 이렇게되면 확률적으로 최신정보를 가져올 수 있음.
- 어떤노드든 블록을 쓰고 전파할 수 있기때문에, 최대한 많은 노드와 연결을 하고 블록전파에 힘을 써야 최신데이터를 확보할 수 있다.
- 마이닝 노드 = 블록을 쓰고 네트워크에 전파한 노드

### 2. 클레이튼

- ⭐️Two Layer Architecture Trust Model(두개의 레열을 가지는 네트워크)
- 매 라운드마다 합의노드들 중 하나가 뽑혀서 블록을 씀
- 최신정보를 받기 위해서는 바로 옆에 붙어야함
- 코어셀 안에 있는 합의노드들이 블록을 만든다는 사실을 바깥에 있는 Endpoint Node들이 알고있기 때문에, 옆에 바로 붙음 (그래야 신뢰높은 정보를 불러오거나 쓸 수 있음)
- 우리가 어떤 어플리케이션을 만들 때, 서버들도 같이 구축을 하게 됨.
- ⭐️서버는 코어셀과 직접적으로 연결시킬 수 없으니까 블록체인 정보에 접근하려면 Endpoint Node에 먼저 연결을 해야함
- ⭐️내부 블록체인에 접근할 때, Endpoint Node가 코어셀 네트워크에 연결해서 빠르게 데이터를 쓰거나 받을 수 있는 구조
- Endpoint Node를 개인적으로 운영은 쉽지않음
- 대부분 외부공용노드와 연결해서 블록체인 정보를 읽음
- 이더리움과 달리 메인넷과 부분적으로 소통할 수 있고 독립된 서비스 공간을 구축하는 klaytn ServiceChain이 있다

<hr />

클레이튼의 Gas Price는 어떤 트랜잭션을 처리하든 항상 25 ston으로 고정되어있다. Gas Limit은 트랜잭션을 처리하며 들어가는 최대 한도비용(트랜잭션내에 무한 반복문이 있다고 가정하면 트랜잭션이 네트워크 내에서 계속 돌아가고 있는 상태가 됨 -> 네트워크의 성능저하를 불러일으킴 -> Gas Limit이상만큼 수수료가 들어가면 이상함을 감지하고 처리를 멈춤 )
ston은 클레이튼의 단위 중 하나

- (참고) 단순한 송금을 보낼때는 트랜잭션비용은 0.0025KLAY로 고정되어있지만, 스마트계약을 통한 트랜잭션은 복잡성에 따라 Gas Limit이 바뀌기 떄문에 트랜잭션비용이 고정되어있지않음
  이더리움의 gas price는 변동이라 전체수수료비용을 예측하기 힘듬
